<!DOCTYPE html>
<html lang="tr" dir="ltr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title data-i18n="meta.title">Ãœreten Eller Platformu</title>
<style>
:root{
  --ink:#0f172a; --muted:#475569; --accent:#0ea5e9; --brd:#e2e8f0;
  --danger:#ff0000; --danger-glow:#ff4500; --card:#ffffff; --bg:#ffffff;
}
html,body{height:100%;margin:0;padding:0;display:flex;flex-direction:column;min-height:100%;font-family:system-ui,Segoe UI,Roboto,Ubuntu,sans-serif;background:var(--bg);color:#111}

/* HEADER */
.header{display:flex;align-items:center;justify-content:space-between;padding:1rem 2rem;box-shadow:0 2px 6px rgba(0,0,0,.05);background:#fff;position:sticky;top:0;z-index:20}
.header-left{display:flex;align-items:center;gap:.75rem}
.header-left img{width:40px;height:40px}
.header-left h1{font-size:1.6rem;margin:0;font-weight:900;color:#ff0000}
.header-right{display:flex;align-items:center;gap:1rem}
.btn{padding:.6rem .9rem;border-radius:12px;border:1px solid #ddd;font-weight:700;cursor:pointer;background:#fff;transition:.2s}
.btn.primary{background:linear-gradient(180deg,#ff4b1f,#ff9068);color:#fff;border:none;box-shadow:0 0 15px rgba(255,77,0,.7)}
.btn.primary:hover{filter:brightness(1.1)}
.lang-select{padding:.5rem;border-radius:8px;border:1px solid #ddd;font-weight:600;cursor:pointer;background:#fff}

/* SUBTEXT */
.subtext{text-align:center;margin-top:.25rem;font-weight:600;color:#ff4b1f;font-size:1.1rem}

/* ALERT PANEL */
#alertTicker{position:relative;overflow:hidden;width:100%;margin:1rem 0 0}
.alert-slide{width:100%;background:linear-gradient(90deg,rgba(255,10,0,1),rgba(255,80,0,1),rgba(255,0,0,1));color:#fff;border-radius:0;padding:2.2rem 1rem;text-align:center;
  box-shadow:0 0 40px rgba(255,20,0,.7), inset 0 1px 0 rgba(255,255,255,.3);
  backdrop-filter:saturate(1.8) blur(10px);animation:slideInHoldOut 20s ease-in-out both;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.75rem}
.alert-title{font-weight:900;font-size:2.2rem;letter-spacing:.3px}
.alert-text{opacity:.98;font-size:1.12rem;max-width:1100px}
@keyframes slideInHoldOut{0%{transform:translateX(110%);opacity:.2}10%,90%{transform:translateX(0);opacity:1}100%{transform:translateX(-110%);opacity:.2}}

/* LISTINGS */
.section{max-width:1280px;margin:1rem auto;padding:0 1rem}
.section h2{margin:.2rem 0 .6rem;font-size:1.25rem}
.grid{display:grid;gap:.85rem}
/* mobile 2, tablet/desktop 4 */
@media(min-width:0){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
@media(min-width:900px){.grid{grid-template-columns:repeat(4,minmax(0,1fr))}}
.card{background:var(--card);border:1px solid var(--brd);border-radius:14px;overflow:hidden;display:flex;flex-direction:column}
.thumb{aspect-ratio:1/1;background:#f1f5f9;background-size:cover;background-position:center}
.meta{padding:.6rem .7rem}
.title{font-weight:800}
.price{font-weight:900;color:#ef4444;margin-top:.1rem}
.mini{color:#64748b}

/* AUTH MODAL */
.backdrop{position:fixed;inset:0;background:#0008;backdrop-filter:saturate(.9) blur(2px);display:none;z-index:999}
.modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:min(680px,92vw);max-height:85vh;overflow:auto;background:#fff;border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 24px 80px rgba(0,0,0,.2);padding:1rem;display:none;z-index:1000}
.modal .tabs{display:flex;gap:.5rem;margin-bottom:.75rem}
.modal .tab{flex:1;text-align:center;padding:.55rem;border:1px solid #e5e7eb;border-radius:999px;background:#fff;cursor:pointer;font-weight:700;color:#111}
.modal .tab[aria-selected="true"]{outline:2px solid var(--accent)}
.modal .field{display:flex;flex-direction:column;gap:.35rem;margin:.5rem 0}
.modal label{color:#111;font-size:.95rem;font-weight:700}
.modal input, .modal select{background:#fff;border:1px solid #cbd5e1;border-radius:10px;padding:.6rem .7rem;color:#111}
.modal .close{position:absolute;right:.6rem;top:.6rem;border:1px solid #e5e7eb;background:#fff;color:#111;border-radius:10px;padding:.25rem .5rem;cursor:pointer;font-weight:800}
.row{display:flex;gap:.5rem;align-items:center}
.input-inline{display:flex;gap:.5rem;align-items:center}
.eye{border:1px solid #e5e7eb;background:#fff;border-radius:8px;padding:.35rem .6rem;cursor:pointer;font-weight:700}
.muted{color:#64748b}

/* FOOTER */
footer{background:#000;color:#fff;padding:2rem;text-align:center;margin-top:auto}
footer a{color:#f87171;text-decoration:none;margin:0 .5rem;font-weight:500}
footer a:hover{text-decoration:underline}
footer p{margin:.5rem 0;font-size:.95rem}
</style>
</head>
<body>
<header class="header">
  <div class="header-left">
    <img src="/assets/icons/ureteneller.png" alt="logo"/>
    <h1>Ãœreten Eller</h1>
  </div>
  <div class="header-right">
    <button class="btn primary" id="btnSignup" data-i18n="cta.signup">Ãœcretsiz Kaydol</button>
    <button class="btn" id="btnLogin" data-i18n="cta.login">GiriÅŸ Yap</button>
    <select class="lang-select" id="langSelect" aria-label="Language">
      <option value="tr">ðŸ‡¹ðŸ‡· TÃ¼rkÃ§e</option>
      <option value="en">ðŸ‡¬ðŸ‡§ English</option>
      <option value="de">ðŸ‡©ðŸ‡ª Deutsch</option>
      <option value="ar">ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
    </select>
  </div>
</header>
<div id="netWarn" style="display:none;background:#fff3cd;color:#7a5d00;border:1px solid #ffe69c;padding:.6rem 1rem;text-align:center">BaÄŸlantÄ± sorunu: Firestore'a ulaÅŸÄ±lamÄ±yor. Ä°Ã§erikler Ã§evrimdÄ±ÅŸÄ± modda gÃ¶steriliyor, baÄŸlantÄ± geldiÄŸinde otomatik yenilenecek.</div>
<div class="subtext" id="commissionText">Ãœreten Eller platformu asla sizden komisyon almaz</div>
<div id="alertTicker"></div>

<!-- LISTINGS (single panel: top row = featured, auto-rotates) -->
<section class="section" aria-labelledby="allTitle">
  <h2 id="allTitle" data-i18n="list.all">Ä°lanlar</h2>
  <div class="mini" id="allInfo"></div>
  <div class="grid" id="allGrid" aria-live="polite"></div>
</section>

<!-- Auth Modal Markup -->
<div class="backdrop" id="bdAuth"></div>
<div class="modal" id="authModal" role="dialog" aria-modal="true" aria-hidden="true">
  <button class="close" id="closeAuth" aria-label="Kapat">âœ•</button>
  <div class="tabs" role="tablist">
    <button class="tab" id="tabLogin" role="tab" aria-selected="true" data-i18n="auth.login">GiriÅŸ Yap</button>
    <button class="tab" id="tabSignup" role="tab" aria-selected="false" data-i18n="auth.signup">KayÄ±t Ol</button>
  </div>

  <!-- LOGIN -->
  <form id="loginForm" novalidate>
    <div class="field"><label for="lemail" data-i18n="auth.email">Eâ€‘posta</label><input id="lemail" type="email" required /></div>
    <div class="field"><label for="lpass" data-i18n="auth.password">Åžifre</label>
      <div class="input-inline">
        <input id="lpass" type="password" required />
        <button class="eye" type="button" data-toggle="lpass" data-i18n="auth.show">GÃ¶ster</button>
      </div>
    </div>
    <div class="row" style="justify-content:space-between;margin:.25rem 0 .75rem">
      <button class="btn" type="button" id="gLogin" data-i18n="auth.google">Google ile giriÅŸ</button>
      <div class="row">
        <button class="btn" type="button" id="forgotBtn" data-i18n="auth.forgot">Åžifremi Unuttum</button>
        <button class="btn primary" id="loginSubmit" type="submit" data-i18n="auth.login">GiriÅŸ Yap</button>
      </div>
    </div>
    <div id="lmsg" class="muted" style="margin-top:.2rem"></div>
  </form>

  <!-- SIGNUP -->
  <form id="signupForm" style="display:none" novalidate>
    <div class="field"><label for="suser" data-i18n="auth.username">KullanÄ±cÄ± AdÄ±</label><input id="suser" type="text" required /></div>
    <div class="row">
      <div class="field" style="flex:1"><label for="sname" data-i18n="auth.name">Ä°sim</label><input id="sname" type="text" required /></div>
      <div class="field" style="flex:1"><label for="ssurname" data-i18n="auth.surname">Soyisim</label><input id="ssurname" type="text" required /></div>
    </div>
    <div class="field"><label for="scity" data-i18n="auth.city">Åžehir</label><input id="scity" type="text" placeholder="Ä°l/Ä°lÃ§e" /></div>
    <div class="field"><label for="semail" data-i18n="auth.email">Eâ€‘posta</label><input id="semail" type="email" required /></div>
    <div class="row">
      <div class="field" style="flex:1"><label for="spass" data-i18n="auth.password">Åžifre</label>
        <div class="input-inline"><input id="spass" type="password" minlength="6" required /><button class="eye" type="button" data-toggle="spass" data-i18n="auth.show">GÃ¶ster</button></div>
      </div>
      <div class="field" style="flex:1"><label for="spass2" data-i18n="auth.password2">Åžifre (Tekrar)</label>
        <div class="input-inline"><input id="spass2" type="password" minlength="6" required /><button class="eye" type="button" data-toggle="spass2" data-i18n="auth.show">GÃ¶ster</button></div>
      </div>
    </div>
    <div class="field"><label><input type="checkbox" id="ckKvkk" required> <span data-i18n="consent.kvkk">KVKK AydÄ±nlatma metnini okudum ve kabul ediyorum.</span></label></div>
    <div class="field"><label><input type="checkbox" id="ckCookies" required> <span data-i18n="consent.cookies">Ã‡erez PolitikasÄ±â€™nÄ± okudum ve kabul ediyorum.</span></label></div>
    <div class="row" style="justify-content:flex-end;margin-top:.25rem">
      <button class="btn primary" id="signupSubmit" type="submit" data-i18n="auth.signup">KayÄ±t Ol</button>
    </div>
    <div id="smsg" class="muted" style="margin-top:.2rem"></div>
  </form>
</div>

<footer>
  <p>
    <a href="/legal/iletisim-impressum.html" data-i18n="legal.contact">Ä°letiÅŸim / Impressum</a> |
    <a href="/legal/gizlilik-politikasi.html" data-i18n="legal.privacy">Gizlilik PolitikasÄ±</a> |
    <a href="/legal/kvkk-aydinlatma.html" data-i18n="legal.kvkk">KVKK AydÄ±nlatma</a> |
    <a href="/legal/cerez-politikasi.html" data-i18n="legal.cookies">Ã‡erez PolitikasÄ±</a> |
    <a href="/legal/kullanim-sartlari.html" data-i18n="legal.terms">KullanÄ±m ÅžartlarÄ±</a> |
    <a href="/legal/mesafeli-satis-sozlesmesi.html" data-i18n="legal.distance">Mesafeli SatÄ±ÅŸ SÃ¶zleÅŸmesi</a> |
    <a href="/legal/on-bilgilendirme-formu.html" data-i18n="legal.pref">Ã–n Bilgilendirme Formu</a> |
    <a href="/legal/teslimat-iade-iptal.html" data-i18n="legal.delivery">Teslimat & Ä°ade</a> |
    <a href="/legal/topluluk-kurallari.html" data-i18n="legal.rules">Topluluk KurallarÄ±</a> |
    <a href="/legal/yasakli-urunler.html" data-i18n="legal.banned">YasaklÄ± ÃœrÃ¼nler</a> |
    <a href="/legal/iletisim-impressum.html#destek" data-i18n="legal.support">Destek</a>
  </p>
  <p>Â© 2025 Ãœreten Eller<br><span data-i18n="legal.guarantee">TÃ¼m iÅŸlemler Ãœreten Eller teknik altyapÄ±sÄ± ve Ã¶deme gÃ¼vencesi altÄ±ndadÄ±r.</span></p>
</footer>

<!-- Item Detail Modal -->
<div class="backdrop" id="bdDetail" style="display:none"></div>
<div class="modal" id="detailModal" role="dialog" aria-modal="true" aria-hidden="true" style="display:none">
  <button class="close" id="closeDetail" aria-label="Kapat">âœ•</button>
  <div id="detailBody"></div>
</div>

<!-- i18n + UI wiring (non-module) -->
<script>
const I18N = {
  tr: { meta:{title:'Ãœreten Eller Platformu'}, commission:'Ãœreten Eller platformu asla sizden komisyon almaz', cta:{signup:'Ãœcretsiz Kaydol', login:'GiriÅŸ Yap'}, auth:{email:'Eâ€‘posta', password:'Åžifre', password2:'Åžifre (Tekrar)', username:'KullanÄ±cÄ± AdÄ±', name:'Ä°sim', surname:'Soyisim', city:'Åžehir', show:'GÃ¶ster', hide:'Gizle', login:'GiriÅŸ Yap', signup:'KayÄ±t Ol', forgot:'Åžifremi Unuttum', google:'Google ile giriÅŸ'}, legal:{contact:'Ä°letiÅŸim / Impressum', privacy:'Gizlilik PolitikasÄ±', kvkk:'KVKK AydÄ±nlatma', cookies:'Ã‡erez PolitikasÄ±', terms:'KullanÄ±m ÅžartlarÄ±', distance:'Mesafeli SatÄ±ÅŸ SÃ¶zleÅŸmesi', pref:'Ã–n Bilgilendirme Formu', delivery:'Teslimat & Ä°ade', rules:'Topluluk KurallarÄ±', banned:'YasaklÄ± ÃœrÃ¼nler', support:'Destek', guarantee:'TÃ¼m iÅŸlemler Ãœreten Eller teknik altyapÄ±sÄ± ve Ã¶deme gÃ¼vencesi altÄ±ndadÄ±r.'}, list:{all:'Ä°lanlar', count:(n)=>`(${n})`, infoTop:'Ãœst sÄ±rada Vitrin ilanlar gÃ¶sterilir.'}, errors:{required:'Bu alan zorunludur.', mailOrPass:'Eâ€‘posta veya ÅŸifre hatalÄ±.', passMismatch:'Åžifreler eÅŸleÅŸmiyor.', verifySent:'KayÄ±t baÅŸarÄ±lÄ±. LÃ¼tfen eâ€‘postanÄ±zÄ± doÄŸrulayÄ±n. Spam/Ã–nemsiz klasÃ¶rÃ¼nÃ¼ de kontrol edin.', resetSent:'SÄ±fÄ±rlama baÄŸlantÄ±sÄ± gÃ¶nderildi. Gelen kutusu ve Spam klasÃ¶rÃ¼nÃ¼ kontrol edin.'}, cats:[
    {t:'ðŸ§¶ Ã–rgÃ¼ / Triko', s:['HÄ±rka','AtkÄ±','Bere'], d:'Evin sÄ±caklÄ±ÄŸÄ±nÄ± taÅŸÄ±yan el emeÄŸi Ã¶rgÃ¼ler. KiÅŸiye Ã¶zel Ã¶lÃ§Ã¼ ve renk seÃ§enekleri, doÄŸal ipliklerle uzun Ã¶mÃ¼rlÃ¼ kullanÄ±m.'},
    {t:'ðŸŽ‚ Pasta & TatlÄ±', s:['Pasta','Kurabiye','SÃ¼tlÃ¼'], d:'GÃ¼nlÃ¼k taze Ã¼retim, katkÄ±sÄ±z malzeme. DoÄŸum gÃ¼nÃ¼, niÅŸan ve tÃ¼m Ã¶zel gÃ¼nler iÃ§in kiÅŸiye Ã¶zel tasarÄ±mlar.'},
    {t:'ðŸ² Yemekler', s:['Ev yemekleri','BÃ¶rek-Ã§Ã¶rek','Ã‡orba'], d:'Ev lezzetleri hijyenik mutfaklarda hazÄ±rlanÄ±r. Diyet, vegan ve Ã§ocuk menÃ¼sÃ¼ seÃ§enekleri bulunur.'},
    {t:'ðŸ«™ ReÃ§el â€¢ TurÅŸu â€¢ Sos', s:['ReÃ§el','TurÅŸu','Sos'], d:'Mevsiminde toplanan Ã¼rÃ¼nlerle, anne tarifiyle hazÄ±rlanan doÄŸal kavanoz Ã¼rÃ¼nleri.'},
    {t:'ðŸŒ¾ YÃ¶resel / KÄ±ÅŸlÄ±k', s:['EriÅŸte','Tarhana','Yufka'], d:'Geleneksel yÃ¶ntemlerle hazÄ±rlanmÄ±ÅŸ kÄ±ÅŸlÄ±k erzak; sofranÄ±za nostalji katar.'},
    {t:'ðŸ§¼ DoÄŸal Sabun & Kozmetik', s:['Sabun','Åžampuan','Krem'], d:'ZeytinyaÄŸlÄ± ve bitkisel iÃ§erikli Ã¼rÃ¼nler; hassas ciltler iÃ§in nazik formÃ¼ller.'},
    {t:'ðŸ’ TakÄ±', s:['Bileklik','Kolye','KÃ¼pe'], d:'El iÅŸÃ§iliÄŸi takÄ±lar; doÄŸal taÅŸlar ve kiÅŸiye Ã¶zel tasarÄ±mlar hediye iÃ§in ideal.'},
    {t:'ðŸ‘¶ Bebek & Ã‡ocuk', s:['Oyuncak','Battaniye','Aksesuar'], d:'Bebek cildiyle uyumlu, gÃ¼venli ve sevgiyle Ã¶rÃ¼lmÃ¼ÅŸ Ã¼rÃ¼nler.'},
    {t:'âœ‚ï¸ DikiÅŸ / Terzilik', s:['PaÃ§a','Fermuar','Ã–zel dikim'], d:'OnarÄ±m, tadilat ve kiÅŸiye Ã¶zel kalÄ±p hizmetleri. Ã–lÃ§Ã¼nÃ¼ze Ã¶zel dikim.'},
    {t:'ðŸ§µ Makrome & Dekor', s:['Duvar sÃ¼sÃ¼','SaksÄ± askÄ±sÄ±','AnahtarlÄ±k'], d:'El dÃ¼ÄŸÃ¼mleriyle modern dekor. Ev ve ofisiniz iÃ§in sÄ±cak dokunuÅŸlar.'},
    {t:'ðŸ  Ev Dekor & Aksesuar', s:['KÄ±rlent','KapÄ± sÃ¼sÃ¼','Ã‡erÃ§eve'], d:'MekanÄ±nÄ±za karakter katan, elde yapÄ±lmÄ±ÅŸ dekoratif parÃ§alar.'},
    {t:'ðŸ•¯ï¸ Mum & Kokulu ÃœrÃ¼nler', s:['Mum','Oda spreyi','Hediye seti'], d:'Soya/balmumu mumlar doÄŸal esanslarla. RahatlatÄ±cÄ± kokular, ÅŸÄ±k ambalaj.'},
    {t:'ðŸ§¸ Amigurumi & Oyuncak (dekor)', s:['AnahtarlÄ±k','Magnet','FigÃ¼r'], d:'Koleksiyonluk ve dekoratif karakterler, hediye notuyla birlikte.'}
  ],
  platform:{title:'Ãœreten Eller GÃ¼vencesi', desc:'Ã–demeler ve Ã¼rÃ¼n teslimatÄ± Ãœreten Eller teknik altyapÄ±sÄ± gÃ¼vencesinde yÃ¼rÃ¼tÃ¼lÃ¼r. AracÄ±sÄ±z, adil fiyat; satÄ±cÄ± ve alÄ±cÄ± iÃ§in gÃ¼venli sÃ¼reÃ§.'}
  },
  en: { meta:{title:'Ureten Eller Platform'}, commission:'Ãœreten Eller never charges commissions from you', cta:{signup:'Sign up free', login:'Log In'}, auth:{email:'Email', password:'Password', password2:'Password (Repeat)', username:'Username', name:'Name', surname:'Surname', city:'City', show:'Show', hide:'Hide', login:'Log In', signup:'Sign Up', forgot:'Forgot password', google:'Continue with Google'}, legal:{contact:'Contact / Impressum', privacy:'Privacy Policy', kvkk:'KVKK Notice', cookies:'Cookie Policy', terms:'Terms of Use', distance:'Distance Sales Agreement', pref:'Pre-Information Form', delivery:'Delivery & Returns', rules:'Community Rules', banned:'Prohibited Products', support:'Support', guarantee:'All transactions are secured by Ãœreten Eller infrastructure and payment protection.'}, list:{all:'Listings', count:(n)=>`(${n})`, infoTop:'Featured listings are always pinned to the top row.'}, errors:{required:'This field is required.', mailOrPass:'Email or password is incorrect.', passMismatch:'Passwords do not match.', verifySent:'Sign up successful. Please verify your email and check your spam folder.', resetSent:'Reset link sent. Please check your inbox and spam folder.'}, cats:[
    {t:'ðŸ§¶ Knit / Crochet', s:['Cardigan','Scarf','Beanie'], d:'Handcrafted warmth with natural yarns. Personalized sizes and colors.'},
    {t:'ðŸŽ‚ Cakes & Desserts', s:['Cake','Cookies','Milk desserts'], d:'Fresh daily production with clean ingredients. Custom designs for every occasion.'},
    {t:'ðŸ² Meals', s:['Home meals','Pastry','Soup'], d:'Home-style flavors from hygienic kitchens. Diet, vegan and kids menus available.'},
    {t:'ðŸ«™ Jams â€¢ Pickles â€¢ Sauces', s:['Jam','Pickles','Sauce'], d:'Seasonal produce preserved with traditional recipes.'},
    {t:'ðŸŒ¾ Local / Winter Pantry', s:['Noodles','Tarhana','Yufka'], d:'Traditional pantry staples to bring nostalgia to your table.'},
    {t:'ðŸ§¼ Natural Soap & Cosmetics', s:['Soap','Shampoo','Cream'], d:'Olive oil and herbal-based formulas gentle to the skin.'},
    {t:'ðŸ’ Jewelry', s:['Bracelet','Necklace','Earrings'], d:'Handmade jewelry with gemstones; perfect for gifts.'},
    {t:'ðŸ‘¶ Baby & Kids', s:['Toy','Blanket','Accessory'], d:'Safe and soft items crafted with care for babies and kids.'},
    {t:'âœ‚ï¸ Sewing / Tailoring', s:['Hem','Zipper','Custom sew'], d:'Repairs, alterations and custom patterns to fit you.'},
    {t:'ðŸ§µ Macrame & Decor', s:['Wall hanging','Plant hanger','Keychain'], d:'Modern decor with handcrafted knots for warm spaces.'},
    {t:'ðŸ  Home Decor & Accessories', s:['Cushion','Door wreath','Frame'], d:'Pieces that give character to your living space.'},
    {t:'ðŸ•¯ï¸ Candles & Fragrances', s:['Candle','Room spray','Gift set'], d:'Soy/beeswax candles with natural scents in elegant packs.'},
    {t:'ðŸ§¸ Amigurumi & Toys (decor)', s:['Keychain','Magnet','Figure'], d:'Collectible decorative characters with a gift note.'}
  ],
  platform:{title:'Ãœreten Eller Guarantee', desc:'Payments and deliveries are protected by Ãœreten Eller infrastructure. Direct, fair pricing and a safe flow for both sides.'}
  },
  de: { meta:{title:'Ãœreten Eller Plattform'}, commission:'Ãœreten Eller erhebt keine Provision von Ihnen', cta:{signup:'Kostenlos registrieren', login:'Anmelden'}, auth:{email:'Eâ€‘Mail', password:'Passwort', password2:'Passwort (Wieder)', username:'Benutzername', name:'Name', surname:'Nachname', city:'Stadt', show:'Anzeigen', hide:'Verbergen', login:'Anmelden', signup:'Registrieren', forgot:'Passwort vergessen', google:'Mit Google fortfahren'}, legal:{contact:'Kontakt / Impressum', privacy:'Datenschutz', kvkk:'KVKK-Hinweis', cookies:'Cookie-Richtlinie', terms:'Nutzungsbedingungen', distance:'Fernabsatzvertrag', pref:'Vorabinformation', delivery:'Lieferung & RÃ¼ckgabe', rules:'Community-Regeln', banned:'Verbotene Produkte', support:'Support', guarantee:'Alle Transaktionen sind durch die Ãœreten Eller Infrastruktur und Zahlungssicherheit geschÃ¼tzt.'}, list:{all:'Anzeigen', count:(n)=>`(${n})`, infoTop:'Schaufenster-Anzeigen immer in der obersten Reihe.'}, errors:{required:'Dieses Feld ist erforderlich.', mailOrPass:'Eâ€‘Mail oder Passwort ist falsch.', passMismatch:'PasswÃ¶rter stimmen nicht Ã¼berein.', verifySent:'Registrierung erfolgreich. Bitte Eâ€‘Mail verifizieren (Spam prÃ¼fen).', resetSent:'Link gesendet. Posteingang/Spam prÃ¼fen.'}, cats:[
    {t:'ðŸ§¶ Strick / HÃ¤keln', s:['Cardigan','Schal','MÃ¼tze'], d:'Handgemachte WÃ¤rme aus natÃ¼rlichen Garnen. Individuelle GrÃ¶ÃŸen und Farben.'},
    {t:'ðŸŽ‚ Kuchen & SÃ¼ÃŸes', s:['Torte','Kekse','Milchdesserts'], d:'TÃ¤glich frisch, ohne Zusatzstoffe. MaÃŸgeschneiderte Designs.'},
    {t:'ðŸ² Gerichte', s:['Hausmannskost','GebÃ¤ck','Suppe'], d:'Hausgemachte Aromen aus hygienischen KÃ¼chen. DiÃ¤t, vegan und Kinder-MenÃ¼s.'},
    {t:'ðŸ«™ Marmelade â€¢ Pickles â€¢ Saucen', s:['Marmelade','Eingelegtes','Sauce'], d:'Saisonale Zutaten, traditionelle Rezepte.'},
    {t:'ðŸŒ¾ Regional / Wintervorrat', s:['Bandnudeln','Tarhana','Yufka'], d:'Traditionelle VorrÃ¤te fÃ¼r nostalgische Tafel.'},
    {t:'ðŸ§¼ NatÃ¼rliche Seife & Kosmetik', s:['Seife','Shampoo','Creme'], d:'OlivenÃ¶l- und KrÃ¤uterbasis, sanft zur Haut.'},
    {t:'ðŸ’ Schmuck', s:['Armband','Kette','Ohrringe'], d:'Handgefertigt mit Edelsteinen â€“ ideal als Geschenk.'},
    {t:'ðŸ‘¶ Baby & Kinder', s:['Spielzeug','Decke','Accessoire'], d:'Sichere, weiche Produkte mit Liebe gefertigt.'},
    {t:'âœ‚ï¸ Schneiderei', s:['Saum','ReiÃŸverschluss','MaÃŸarbeit'], d:'Reparatur, Anpassung und MaÃŸanfertigung.'},
    {t:'ðŸ§µ Makramee & Deko', s:['Wandbehang','PflanzenhÃ¤nger','SchlÃ¼sselanhÃ¤nger'], d:'HandgeknÃ¼pfte, moderne Dekorationen.'},
    {t:'ðŸ  Wohndeko & Accessoires', s:['Kissen','TÃ¼rkranz','Rahmen'], d:'Charaktervolle StÃ¼cke fÃ¼r Ihr Zuhause.'},
    {t:'ðŸ•¯ï¸ Kerzen & DÃ¼fte', s:['Kerze','Raumspray','Geschenkset'], d:'Soja-/Bienenwachs mit natÃ¼rlichen DÃ¼ften.'},
    {t:'ðŸ§¸ Amigurumi & Spielzeug (Deko)', s:['SchlÃ¼sselanhÃ¤nger','Magnet','Figur'], d:'Sammelbare, dekorative Figuren.'}
  ],
  platform:{title:'Ãœreten Eller Garantie', desc:'Zahlung und Lieferung sind durch die Infrastruktur von Ãœreten Eller geschÃ¼tzt. Direkt, fair und sicher.'}
  },
  ar: { meta:{title:'Ù…Ù†ØµÙ‘Ø© Ãœreten Eller'}, commission:'Ù…Ù†ØµÙ‘Ø© Ãœreten Eller Ù„Ø§ ØªØªÙ‚Ø§Ø¶Ù‰ Ø¹Ù…ÙˆÙ„Ø© Ù…Ù†Ùƒ Ø£Ø¨Ø¯Ù‹Ø§', cta:{signup:'Ø³Ø¬Ù‘Ù„ Ù…Ø¬Ø§Ù†Ù‹Ø§', login:'Ø¯Ø®ÙˆÙ„'}, auth:{email:'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', password:'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', password2:'ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', username:'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', name:'Ø§Ù„Ø§Ø³Ù…', surname:'Ø§Ù„ÙƒÙ†ÙŠØ©', city:'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', show:'Ø¥Ø¸Ù‡Ø§Ø±', hide:'Ø¥Ø®ÙØ§Ø¡', login:'Ø¯Ø®ÙˆÙ„', signup:'ØªØ³Ø¬ÙŠÙ„', forgot:'Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', google:'Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¹Ø¨Ø± Google'}, legal:{contact:'Ø§ØªØµØ§Ù„ / Ø¥Ù…Ø¨Ø±ÙŠØ³ÙˆÙ…', privacy:'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©', kvkk:'Ø¥Ø´Ø¹Ø§Ø± KVKK', cookies:'Ø³ÙŠØ§Ø³Ø© Ø§Ù„ÙƒÙˆÙƒÙŠØ²', terms:'Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…', distance:'Ø¹Ù‚Ø¯ Ø§Ù„Ø¨ÙŠØ¹ Ø¹Ù† Ø¨ÙØ¹Ø¯', pref:'Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³Ø¨Ù‚Ø©', delivery:'Ø§Ù„ØªØ³Ù„ÙŠÙ… ÙˆØ§Ù„Ø¥Ø±Ø¬Ø§Ø¹', rules:'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹', banned:'Ù…Ù†ØªØ¬Ø§Øª Ù…Ø­Ø¸ÙˆØ±Ø©', support:'Ø§Ù„Ø¯Ø¹Ù…', guarantee:'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª ØªØ­Øª Ø¶Ù…Ø§Ù† Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© ÙˆÙˆØ³ÙŠØ· Ø§Ù„Ø¯ÙØ¹ Ù„Ù…Ù†ØµØ© Ãœreten Eller.'}, list:{all:'Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª', count:(n)=>`(${n})`, infoTop:'ØªØ¸Ù‡Ø± Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ Ø¯Ø§Ø¦Ù…Ù‹Ø§ ÙÙŠ Ø§Ù„ØµÙ Ø§Ù„Ø¹Ù„ÙˆÙŠ.'}, errors:{required:'Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ù…Ø·Ù„ÙˆØ¨.', mailOrPass:'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.', passMismatch:'ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†.', verifySent:'ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­. ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø¨Ø±ÙŠØ¯Ùƒ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ø§Ù„Ù…Ø±ØºÙˆØ¨ ÙÙŠÙ‡Ø§.', resetSent:'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆØ§Ø±Ø¯ ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ø§Ù„Ù…Ø±ØºÙˆØ¨ ÙÙŠÙ‡Ø§.'}, cats:[
    {t:'ðŸ§¶ Ø­ÙŠØ§ÙƒØ©', s:['ÙƒØ§Ø±Ø¯ÙŠØ¬Ø§Ù†','ÙˆØ´Ø§Ø­','Ù‚Ø¨Ø¹Ø©'], d:'Ø¯ÙØ¡ Ù…ØµÙ†ÙˆØ¹ ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø¨Ø®ÙŠÙˆØ· Ø·Ø¨ÙŠØ¹ÙŠØ©. Ù…Ù‚Ø§Ø³Ø§Øª ÙˆØ£Ù„ÙˆØ§Ù† Ù…Ø®ØµØµØ©.'},
    {t:'ðŸŽ‚ ÙƒÙŠÙƒ ÙˆØ­Ù„ÙˆÙŠØ§Øª', s:['ÙƒÙŠÙƒ','Ø¨Ø³ÙƒÙˆÙŠØª','Ø­Ù„ÙˆÙŠØ§Øª Ø¨Ø§Ù„Ø­Ù„ÙŠØ¨'], d:'Ø·Ø§Ø²Ø¬Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø¨Ù…ÙƒÙˆÙ†Ø§Øª Ù†Ø¸ÙŠÙØ©. ØªØµØ§Ù…ÙŠÙ… Ù…Ø®ØµØµØ© Ù„ÙƒÙ„ Ù…Ù†Ø§Ø³Ø¨Ø©.'},
    {t:'ðŸ² Ø£Ø·Ø¹Ù…Ø©', s:['Ø£ÙƒÙ„Ø§Øª Ù…Ù†Ø²Ù„ÙŠØ©','Ù…Ø¹Ø¬Ù†Ø§Øª','Ø´ÙˆØ±Ø¨Ø©'], d:'Ù†ÙƒÙ‡Ø§Øª Ù…Ù†Ø²Ù„ÙŠØ© Ù…Ù† Ù…Ø·Ø§Ø¨Ø® Ù†Ø¸ÙŠÙØ©. Ù‚ÙˆØ§Ø¦Ù… Ù„Ù„Ø­Ù…ÙŠØ© ÙˆØ§Ù„Ù†Ø¨Ø§ØªÙŠÙŠÙ† ÙˆØ§Ù„Ø£Ø·ÙØ§Ù„.'},
    {t:'ðŸ«™ Ù…Ø±Ø¨ÙŠØ§Øª â€¢ Ù…Ø®Ù„Ù„Ø§Øª â€¢ ØµÙ„ØµØ§Øª', s:['Ù…Ø±Ø¨Ù‰','Ù…Ø®Ù„Ù„Ø§Øª','ØµÙ„ØµØ©'], d:'Ù…Ù†ØªØ¬Ø§Øª Ù…ÙˆØ³Ù…ÙŠØ© Ù…Ø­ÙÙˆØ¸Ø© Ø¨ÙˆØµÙØ§Øª ØªÙ‚Ù„ÙŠØ¯ÙŠØ©.'},
    {t:'ðŸŒ¾ Ù…Ø¤Ù† Ù…Ù†Ø²Ù„ÙŠØ©/Ø´ØªÙˆÙŠØ©', s:['Ù†ÙˆØ¯Ù„Ø²','Ø·Ø±Ø®Ø§Ù†Ø©','ÙŠÙˆÙÙƒØ§'], d:'Ù…Ø¤ÙˆÙ†Ø© ØªÙ‚Ù„ÙŠØ¯ÙŠØ© ØªØ¹ÙŠØ¯ Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª Ø¥Ù„Ù‰ Ù…Ø§Ø¦Ø¯ØªÙƒ.'},
    {t:'ðŸ§¼ ØµØ§Ø¨ÙˆÙ† Ø·Ø¨ÙŠØ¹ÙŠ ÙˆØªØ¬Ù…ÙŠÙ„', s:['ØµØ§Ø¨ÙˆÙ†','Ø´Ø§Ù…Ø¨Ùˆ','ÙƒØ±ÙŠÙ…'], d:'ØªØ±ÙƒÙŠØ¨Ø§Øª Ø²ÙŠØª Ø§Ù„Ø²ÙŠØªÙˆÙ† ÙˆØ§Ù„Ø£Ø¹Ø´Ø§Ø¨ØŒ Ù„Ø·ÙŠÙØ© Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø´Ø±Ø©.'},
    {t:'ðŸ’ Ù…Ø¬ÙˆÙ‡Ø±Ø§Øª', s:['Ø³ÙˆØ§Ø±','Ù‚Ù„Ø§Ø¯Ø©','Ø£Ù‚Ø±Ø§Ø·'], d:'Ù…Ø¬ÙˆÙ‡Ø±Ø§Øª ÙŠØ¯ÙˆÙŠØ© Ø¨Ø£Ø­Ø¬Ø§Ø± Ø·Ø¨ÙŠØ¹ÙŠØ©Ø› Ù‡Ø¯ÙŠØ© Ù…Ø«Ø§Ù„ÙŠØ©.'},
    {t:'ðŸ‘¶ Ø£Ø·ÙØ§Ù„', s:['Ù„ÙØ¹Ø¨Ø©','Ø¨Ø·Ø§Ù†ÙŠØ©','Ø¥ÙƒØ³Ø³ÙˆØ§Ø±'], d:'Ù…Ù†ØªØ¬Ø§Øª Ø¢Ù…Ù†Ø© ÙˆÙ†Ø§Ø¹Ù…Ø© Ù…ØµÙ†ÙˆØ¹Ø© Ø¨Ø­Ø¨ Ù„Ù„Ø£Ø·ÙØ§Ù„.'},
    {t:'âœ‚ï¸ Ø®ÙŠØ§Ø·Ø©', s:['Ø«ÙŽÙ†ÙŠ','Ø³Ø­Ù‘Ø§Ø¨','ØªÙØµÙŠÙ„ Ø®Ø§Øµ'], d:'ØªØµÙ„ÙŠØ­Ø§Øª ÙˆØªØ¹Ø¯ÙŠÙ„Ø§Øª ÙˆØªÙØµÙŠÙ„ Ø­Ø³Ø¨ Ø§Ù„Ù…Ù‚Ø§Ø³.'},
    {t:'ðŸ§µ Ù…ÙƒØ±Ù…ÙŠØ© ÙˆØ¯ÙŠÙƒÙˆØ±', s:['Ø²ÙŠÙ†Ø© Ø­Ø§Ø¦Ø·','Ø­Ø§Ù…Ù„ Ù†Ø¨Ø§Øª','Ù…ÙŠØ¯Ø§Ù„ÙŠØ©'], d:'Ø¹ÙÙ‚ÙŽØ¯ ÙŠØ¯ÙˆÙŠØ© Ø¨Ù„Ù…Ø³Ø© Ø¹ØµØ±ÙŠØ© Ù„Ø¯ÙØ¡ Ø§Ù„Ù…ÙƒØ§Ù†.'},
    {t:'ðŸ  Ø¯ÙŠÙƒÙˆØ± Ù…Ù†Ø²Ù„ÙŠ', s:['ÙˆØ³Ø§Ø¯Ø©','Ø²ÙŠÙ†Ø© Ø§Ù„Ø¨Ø§Ø¨','Ø¥Ø·Ø§Ø±'], d:'Ù‚Ø·Ø¹ ØªØ¶ÙŠÙ Ø´Ø®ØµÙŠØ© Ø¥Ù„Ù‰ Ù…Ø³Ø§Ø­ØªÙƒ.'},
    {t:'ðŸ•¯ï¸ Ø´Ù…Ø¹ ÙˆØ±ÙˆØ§Ø¦Ø­', s:['Ø´Ù…Ø¹Ø©','Ù…Ø¹Ø·Ø± Ø¬Ùˆ','Ø·Ù‚Ù… Ù‡Ø¯Ø§ÙŠØ§'], d:'Ø´Ù…ÙˆØ¹ ØµÙˆÙŠØ§/Ø¹Ø³Ù„ Ø¨Ø±ÙˆØ§Ø¦Ø­ Ø·Ø¨ÙŠØ¹ÙŠØ© ÙˆØªØºÙ„ÙŠÙ Ø£Ù†ÙŠÙ‚.'},
    {t:'ðŸ§¸ Ø£Ù…ÙŠØºÙˆØ±ÙˆÙ…ÙŠ ÙˆÙ„ÙØ¹Ø¨ (Ø¯ÙŠÙƒÙˆØ±)', s:['Ù…ÙŠØ¯Ø§Ù„ÙŠØ©','Ù…ØºÙ†Ø§Ø·ÙŠØ³','Ù…Ø¬Ø³Ù‘Ù…'], d:'Ø´Ø®ØµÙŠØ§Øª Ø²Ø®Ø±ÙÙŠØ© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¬Ù…Ø¹.'}
  ],
  platform:{title:'Ø¶Ù…Ø§Ù† Ãœreten Eller', desc:'Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª ÙˆØ§Ù„ØªØ³Ù„ÙŠÙ… Ù…Ø­Ù…ÙŠØ© Ø¨Ø¨Ù†ÙŠØ© Ãœreten Eller Ø§Ù„ØªÙ‚Ù†ÙŠØ©. Ø£Ø³Ø¹Ø§Ø± Ù…Ø¨Ø§Ø´Ø±Ø© ÙˆØ¹Ø§Ø¯Ù„Ø© ÙˆØªØ¯ÙÙ‚ Ø¢Ù…Ù† Ù„Ù„Ø·Ø±ÙÙŠÙ†.'}
  } };
let LANG = localStorage.getItem('ue_lang') || 'tr';
function setDir(){ const dir=(LANG==='ar')?'rtl':'ltr'; document.documentElement.lang=LANG; document.documentElement.dir=dir; }
function applyLang(){
  setDir();
  const L = I18N[LANG] || I18N.tr;
  document.title = L.meta?.title || document.title;
  const elCommission = document.getElementById('commissionText');
  if (elCommission) elCommission.textContent = L.commission;
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const key = el.getAttribute('data-i18n');
    const seg = key.split('.');
    let cur = L;
    for(const s of seg){ cur = (cur||{})[s]; }
    if(typeof cur==='string'){ el.textContent = cur; }
  });
  const sel = document.getElementById('langSelect');
  if (sel) sel.value = LANG;
  CATS_CACHE = L.cats || [];
  alertIndex = 0;
  showAlert();
}

let CATS_CACHE=(I18N[LANG]||I18N.tr).cats||[]; let alertIndex=0; let alertTimer;
function showAlert(){
  const host = document.getElementById('alertTicker');
  if(!host) return;
  host.innerHTML='';
  const cats = (I18N[LANG]||I18N.tr).cats || [];
  if(!cats.length) return;
  const idx = alertIndex % (cats.length + 1);
  let title, text;
  if(idx === cats.length){
    const p = (I18N[LANG]||I18N.tr).platform || {};
    title = `ðŸ”¥ ${p.title || ''}`;
    text  = p.desc || '';
  } else {
    const c = cats[idx];
    title = c.t;
    text  = c.d || ('â€¢ ' + (c.s||[]).join(' â€¢ '));
  }
  const el = document.createElement('div');
  el.className = 'alert-slide';
  el.innerHTML = `<div class="alert-title">${title}</div><div class="alert-text">${text}</div>`;
  host.appendChild(el);
  alertIndex++;
}
function startAlert(){ showAlert(); clearInterval(alertTimer); alertTimer=setInterval(showAlert, 20000); }

// modal wiring
const bd=document.getElementById('bdAuth'); const modal=document.getElementById('authModal'); const tabLogin=document.getElementById('tabLogin'); const tabSignup=document.getElementById('tabSignup'); const loginForm=document.getElementById('loginForm'); const signupForm=document.getElementById('signupForm');
function openAuth(which='login'){ bd.style.display='block'; modal.style.display='block'; modal.setAttribute('aria-hidden','false'); selectTab(which); }
function closeAuth(){ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); bd.style.display='none'; }
function selectTab(which){ const isLogin=which==='login'; tabLogin.setAttribute('aria-selected', isLogin); tabSignup.setAttribute('aria-selected', !isLogin); loginForm.style.display=isLogin?'block':'none'; signupForm.style.display=isLogin?'none':'block'; }

document.getElementById('btnLogin').addEventListener('click',()=>openAuth('login'));
document.getElementById('btnSignup').addEventListener('click',()=>openAuth('signup'));
document.getElementById('closeAuth').addEventListener('click', closeAuth);
bd.addEventListener('click', closeAuth);
document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeAuth(); });

document.addEventListener('click',(e)=>{ const b=e.target.closest('[data-toggle]'); if(!b) return; const id=b.getAttribute('data-toggle'); const el=document.getElementById(id); if(!el) return; const isPwd=el.type==='password'; el.type=isPwd?'text':'password'; const L=I18N[LANG]||I18N.tr; b.textContent=isPwd?L.auth.hide:L.auth.show; });

const sel=document.getElementById('langSelect'); sel.addEventListener('change',()=>{ LANG=sel.value; localStorage.setItem('ue_lang',LANG); applyLang(); });

applyLang(); startAlert();
</script>

<!-- Firebase init (your provided ESM) -->
<script type="module" src="./firebase-init.js"></script>

<!-- Auth + Listings (real Firebase logic) -->
<script type="module">
import { 
  getAuth, GoogleAuthProvider, signInWithPopup, 
  createUserWithEmailAndPassword, sendEmailVerification, 
  sendPasswordResetEmail, onAuthStateChanged, signInWithEmailAndPassword
} from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js';
import { getFirestore, initializeFirestore, persistentLocalCache, persistentSingleTabManager, collection, query, where, orderBy, limit, getDocs } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js';

import { initializeApp, getApps, getApp } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js';
// Fallback init: eÄŸer dÄ±ÅŸtaki ./firebase-init.js yÃ¼klenmezse burada baÅŸlat
const __cfg = { apiKey: "AIzaSyBqYJBZ95AOV-ojKGV0MZn42-OnJYQkdAo", authDomain: "flutter-ai-playground-38ddf.firebaseapp.com", projectId: "flutter-ai-playground-38ddf", storageBucket: "flutter-ai-playground-38ddf.firebasestorage.app", messagingSenderId: "4688234885", appId: "1:4688234885:web:a3cead37ea580495ca5cec" };
const __app = (typeof self!=='undefined' && self.app) ? self.app : (getApps().length? getApp() : initializeApp(__cfg));
const auth = (typeof self!=='undefined' && self.auth) ? self.auth : getAuth(__app);
const db   = (typeof self!=='undefined' && self.db)   ? self.db   : initializeFirestore(__app, {
  experimentalAutoDetectLongPolling: true,
  useFetchStreams: false,
  localCache: persistentLocalCache({ tabManager: persistentSingleTabManager() })
});
const L = ()=> (I18N[localStorage.getItem('ue_lang')||'tr']||I18N.tr);

// LOGIN
const loginBtn = document.getElementById('loginSubmit');
loginBtn.addEventListener('click', async (e)=>{
  e.preventDefault();
  const t=L();
  const email=document.getElementById('lemail').value.trim();
  const pass=document.getElementById('lpass').value;
  const box=document.getElementById('lmsg');
  if(!email||!pass){ box.textContent=t.errors.required; return; }
  try{ await signInWithEmailAndPassword(auth, email, pass); window.location.href='home.html'; }
  catch(err){ box.textContent=t.errors.mailOrPass; }
});

// RESET
document.getElementById('forgotBtn').addEventListener('click', async ()=>{
  const t=L();
  const email=document.getElementById('lemail').value.trim();
  const box=document.getElementById('lmsg');
  if(!email){ box.textContent=t.errors.required; return; }
  try{ await sendPasswordResetEmail(auth, email); box.textContent=t.errors.resetSent; }
  catch(err){ box.textContent=t.errors.mailOrPass; }
});

// GOOGLE
document.getElementById('gLogin').addEventListener('click', async ()=>{
  const t=L();
  const box=document.getElementById('lmsg');
  try{ const provider=new GoogleAuthProvider(); await signInWithPopup(auth, provider); window.location.href='home.html'; }
  catch(err){ box.textContent=t.errors.mailOrPass; }
});

// SIGNUP
document.getElementById('signupSubmit').addEventListener('click', async (e)=>{
  e.preventDefault();
  const t=L();
  const email=document.getElementById('semail').value.trim();
  const p1=document.getElementById('spass').value; const p2=document.getElementById('spass2').value;
  const kvkk=document.getElementById('ckKvkk').checked; const ck=document.getElementById('ckCookies').checked;
  const box=document.getElementById('smsg');
  if(p1!==p2){ box.textContent=t.errors.passMismatch; return; }
  if(!kvkk||!ck){ box.textContent='KVKK ve Ã‡erez onayÄ± gereklidir.'; return; }
  try{ const { user } = await createUserWithEmailAndPassword(auth, email, p1); await sendEmailVerification(user); box.textContent=t.errors.verifySent; }
  catch(err){ box.textContent = err?.message || 'Error'; }
});

// LISTINGS (single panel)
const grid = document.getElementById('allGrid');
const info = document.getElementById('allInfo');
const ROTATE_MS = 60000; // 1 dakika
let featured = []; let latest = []; let featIndex = 0; let rotateTimer;

function priceText(d){ return (typeof d.price==='number') ? new Intl.NumberFormat((localStorage.getItem('ue_lang')||'tr')==='en'?'en-US':'tr-TR',{style:'currency',currency:'TRY'}).format(d.price) : (d.priceText||''); }
function cardHTML(d, idx){
  const url = d.coverUrl || d.image || d.photo || '';
  const bg = url ? `style="background-image:url('${url}')"` : '';
  const title = d.title || d.name || 'ÃœrÃ¼n';
  return `<article class="card" data-index="${idx}">
    <div class="thumb" ${bg}></div>
    <div class="meta"><div class="title">${title}</div><div class="price">${priceText(d)}</div></div>
  </article>`;
}

function renderAll(){
  const cols = matchMedia('(min-width:900px)').matches ? 4 : 2;
  const top = [];
  for(let i=0;i<cols;i++){ if(featured.length){ top.push(featured[(featIndex+i)%featured.length]); } }
  const rest = latest.filter(x=> !top.includes(x)).slice(0, 40 - top.length);
  const data = [...top, ...rest];
  grid.innerHTML = data.map((d,i)=> cardHTML(d,i)).join('');
  const t=L(); info.textContent = `${t.list.count(data.length)} â€¢ ${t.list.infoTop}`;
}

function startRotate(){ clearInterval(rotateTimer); rotateTimer=setInterval(()=>{ featIndex=(featIndex+1)%Math.max(1,featured.length); renderAll(); }, ROTATE_MS); }

async function loadData(){
  const warn = document.getElementById('netWarn');
  try{
    const fq = query(collection(db,'listings'), where('featured','==',true), orderBy('createdAt','desc'), limit(20));
    const lq = query(collection(db,'listings'), orderBy('createdAt','desc'), limit(60));
    const [fs, ls] = await Promise.all([getDocs(fq), getDocs(lq)]);
    featured = []; fs.forEach(ds=> featured.push(ds.data()));
    latest   = []; ls.forEach(ds=> latest.push(ds.data()));
    renderAll(); startRotate();
    if(warn) warn.style.display='none';
  }catch(e){
    // Offline fallback + auto-retry
    if(warn) warn.style.display='block';
    if(!latest.length && !featured.length){
      // show lightweight placeholder so sayfa boÅŸ kalmasÄ±n
      latest = Array.from({length:8}).map((_,i)=>({ title:`Ã–rnek ÃœrÃ¼n ${i+1}`, price: 500 + i*25 }));
      featured = latest.slice(0,4);
      renderAll();
    }
    // periyodik yeniden dene
    if(!window.__ue_retry){
      window.__ue_retry = setInterval(()=>{ if(navigator.onLine){ loadData().catch(()=>{}); } }, 10000);
      window.addEventListener('online', ()=> loadData().catch(()=>{}), { once:true });
    }
  }
}

// CARD CLICK -> detail modal (login CTA if not authenticated)
function openDetail(item){
  const bd=document.getElementById('bdDetail'); const m=document.getElementById('detailModal'); const body=document.getElementById('detailBody');
  const needLogin = !auth.currentUser;
  const t=L();
  const url=item.coverUrl||item.image||item.photo||'';
  body.innerHTML = `
    <div class="row" style="gap:1rem;align-items:flex-start">
      <div style="flex:1;min-width:220px">
        <div class="thumb" style="background-image:url('${url}');width:100%;aspect-ratio:1/1;border-radius:12px"></div>
      </div>
      <div style="flex:2">
        <h3 style="margin:.2rem 0 0;font-size:1.4rem">${item.title||'ÃœrÃ¼n'}</h3>
        <div class="price" style="font-size:1.1rem;margin:.25rem 0 1rem">${priceText(item)}</div>
        <p class="muted">${item.desc||item.description||'ÃœrÃ¼n aÃ§Ä±klamasÄ± yakÄ±nda.'}</p>
        ${needLogin ? `<div style="margin-top:1rem"><button class="btn primary" id="detailLogin">${t.cta?.login||'GiriÅŸ Yap'}</button></div>`:''}
      </div>
    </div>`;
  bd.style.display='block'; m.style.display='block'; m.setAttribute('aria-hidden','false');
  if(needLogin){
    document.getElementById('detailLogin')?.addEventListener('click', ()=>{
      m.style.display='none'; bd.style.display='none'; openAuth('login');
    });
  }
}

grid.addEventListener('click', (e)=>{
  const card = e.target.closest('.card'); if(!card) return;
  const idx = [...grid.children].indexOf(card);
  const cols = matchMedia('(min-width:900px)').matches ? 4 : 2;
  const top = []; for(let i=0;i<cols;i++){ if(featured.length) top.push(featured[(featIndex+i)%featured.length]); }
  const rest = latest.filter(x=> !top.includes(x)).slice(0, 40 - top.length);
  const data = [...top, ...rest]; const item = data[idx]; if(!item) return;
  openDetail(item);
});

document.getElementById('closeDetail').addEventListener('click', ()=>{ document.getElementById('detailModal').style.display='none'; document.getElementById('bdDetail').style.display='none'; });
document.getElementById('bdDetail').addEventListener('click', ()=>{ document.getElementById('detailModal').style.display='none'; document.getElementById('bdDetail').style.display='none'; });

await loadData();
// yeniden deneme tetikleyicisi iÃ§in bir no-op ekleyelim
window.__ue_firstLoadDone = true;
</script>
</body>
</html>
